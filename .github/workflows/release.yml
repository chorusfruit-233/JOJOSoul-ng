name: Release JOJOSoul Game

on:
  push:
    tags:
      - 'v*'
  workflow_dispatch:
    inputs:
      tag_name:
        description: 'Release tag (e.g., v1.0.0)'
        required: true
        default: 'v1.0.0'

jobs:
  create-release:
    runs-on: ubuntu-latest
    outputs:
      upload_url: ${{ steps.create_release.outputs.upload_url }}
      release_id: ${{ steps.create_release.outputs.id }}
    steps:
    - name: Create Release
      id: create_release
      uses: softprops/action-gh-release@v1
      with:
        tag_name: ${{ github.ref_name || github.event.inputs.tag_name }}
        name: JOJO Soul ${{ github.ref_name || github.event.inputs.tag_name }}
        body: |
          ## JOJO Soul v${{ github.ref_name || github.event.inputs.tag_name }}
          
          ### ğŸ‰ æ–°å¢åŠŸèƒ½
          
          **ğŸ—ºï¸ æ–°åœ°å›¾åŒºåŸŸ**
          - ğŸ”ï¸ **é›ªå±±**: 5çº§è§£é”ï¼Œæ–°å¢å†°éœœå·¨äººæ•Œäºº
          - ğŸŒ‘ **æš—å½±é—è¿¹**: å‡»è´¥æ²¼æ³½æ€ªè§£é”ï¼Œæ–°å¢æš—å½±åˆºå®¢æ•Œäºº
          - â›ˆï¸ **é£æš´é«˜åœ°**: å‡»è´¥ç†”å²©æ€ªè§£é”ï¼Œæ–°å¢é›·ç”µå…ƒç´ æ•Œäºº
          - ğŸ›ï¸ **å¤ä»£ç¥æ®¿**: 8çº§è§£é”ï¼Œ3ç§é«˜çº§æ•Œäººå¯é€‰æ‹©æŒ‘æˆ˜
          
          **ğŸ‘¥ æ–°æ•Œäººç±»å‹**
          - â„ï¸ **å†°éœœå·¨äºº**: HP:300, ATK:25, ç«ç„°3.0å€ä¼¤å®³
          - ğŸ¥· **æš—å½±åˆºå®¢**: HP:180, ATK:30, é—ªå…‰3.0å€ä¼¤å®³
          - âš¡ **é›·ç”µå…ƒç´ **: HP:220, ATK:28, æ°´2.0å€ä¼¤å®³
          - ğŸ—¿ **çŸ³åƒå®ˆå«**: HP:350, ATK:35, å¤ä»£ç¥æ®¿æ•Œäºº
          - ğŸ§™ **å¤ä»£æ³•å¸ˆ**: HP:280, ATK:40, å¤ä»£ç¥æ®¿æ•Œäºº
          - âš”ï¸ **ç¥æ®¿éª‘å£«**: HP:400, ATK:30, å¤ä»£ç¥æ®¿æ•Œäºº
          
          **ğŸ›’ æ‰©å±•å•†åº—ç³»ç»Ÿ**
          - ğŸ§™ **é­”æ³•è¢** [200G]: +15% å…ƒç´ ä¼¤å®³åŠ æˆ
          - ğŸ’ª **åŠ›é‡æŠ¤ç¬¦** [150G]: +3 ä¼¤å®³ä¸‹é™å€ç‡
          - ğŸ›¡ï¸ **å®ˆæŠ¤ç›¾** [180G]: +50 ç”Ÿå‘½ä¸Šé™
          - â­ **ç»éªŒè¯æ°´** [80G]: ç›´æ¥è·å¾—100ç»éªŒå€¼
          - ğŸ“œ **å…ƒç´ å·è½´** [120G]: ä¸´æ—¶å¢å¼ºå…ƒç´ ä¼¤å®³2å€
          
          **ğŸ¯ æŠ€èƒ½ç³»ç»Ÿ**
          - å‡çº§è·å¾—æŠ€èƒ½ç‚¹ï¼Œæ¯æ¬¡å‡çº§+1æŠ€èƒ½ç‚¹
          - 5ä¸ªä¸»åŠ¨æŠ€èƒ½ï¼šç«çƒæœ¯ã€æ²»ç–—æœ¯ã€æŠ¤ç›¾ã€å…ƒç´ çˆ†å‘ã€æ—¶é—´å‡ç¼“
          - æ¯ä¸ªæŠ€èƒ½éƒ½æœ‰ç‹¬ç«‹çš„å†·å´æ—¶é—´
          
          **ğŸ† æˆå°±ç³»ç»Ÿ**
          - 15ä¸ªæˆå°±ç­‰ä½ å®Œæˆ
          - æˆ˜æ–—æˆå°±ã€æ”¶é›†æˆå°±ã€æˆé•¿æˆå°±ã€ç‰¹æ®Šæˆå°±
          - å®Œæˆæˆå°±è·å¾—é‡‘å¸å¥–åŠ±
          
          ### ğŸ”§ æŠ€æœ¯æ”¹è¿›
          - å®Œå…¨å…¼å®¹æ—§å­˜æ¡£
          - æ”¯æŒæ‰€æœ‰æ–°åŠŸèƒ½çš„å­˜æ¡£å’Œè¯»æ¡£
          - æ–°å¢20+ä¸ªæµ‹è¯•ç”¨ä¾‹
          - ä¼˜åŒ–æˆ˜æ–—è®¡ç®—é€»è¾‘
          - æå‡æ¸¸æˆæ•´ä½“æ€§èƒ½
          
          ### ğŸ® æ¸¸æˆå¹³è¡¡
          - æ–°æ•Œäººéš¾åº¦ç»è¿‡ç²¾å¿ƒè°ƒæ•´
          - è£…å¤‡ä»·æ ¼å’Œæ•ˆæœå¹³è¡¡
          - æŠ€èƒ½å†·å´æ—¶é—´åˆç†è®¾ç½®
          - æˆå°±å¥–åŠ±é€‚åº¦è°ƒæ•´
          
          ### ğŸ› ä¿®å¤é—®é¢˜
          - ä¿®å¤åŸç‰ˆä¸­çš„å„ç§å°é—®é¢˜
          - æ”¹è¿›ç”¨æˆ·ç•Œé¢ä½“éªŒ
          - ä¼˜åŒ–é”™è¯¯å¤„ç†æœºåˆ¶
          
          ### ğŸ“¦ å®‰è£…è¯´æ˜
          1. ä¸‹è½½å¯¹åº”å¹³å°çš„å¯æ‰§è¡Œæ–‡ä»¶
          2. ç›´æ¥è¿è¡Œå³å¯å¼€å§‹æ¸¸æˆ
          
          ### ğŸŒŸ ç³»ç»Ÿè¦æ±‚
          - Windows 10/11
          - macOS 10.14+
          - Linux (æ”¯æŒå›¾å½¢ç•Œé¢)
          
          ---
          æŸ¥çœ‹å®Œæ•´æ›´æ–°æ—¥å¿—è¯·è®¿é—® [é¡¹ç›®ä¸»é¡µ](https://github.com/chorusfruit-233/JOJOSoul-ng)
        draft: false
        prerelease: false
        files: |
          JOJOSoul-linux-*
          JOJOSoul-mac-*
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

  build-and-upload:
    needs: create-release
    runs-on: ${{ matrix.os }}
    strategy:
      matrix:
        os: [ubuntu-latest, windows-latest, macos-latest]
        include:
          - os: ubuntu-latest
            os_name: linux
            binary_name: JOJOSoul
            binary_extension: ""
          - os: windows-latest
            os_name: windows
            binary_name: JOJOSoul
            binary_extension: ".exe"
          - os: macos-latest
            os_name: mac
            binary_name: JOJOSoul
            binary_extension: ""

    steps:
    - uses: actions/checkout@v4

    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.12'

    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt

    - name: Build with PyInstaller
      run: |
        pyinstaller --onefile --name "${{ matrix.binary_name }}" JOJOSoul-ng.py

    - name: Package for Linux
      if: matrix.os == 'ubuntu-latest'
      run: |
        mkdir -p release
        cp dist/${{ matrix.binary_name }} release/
        tar -czf JOJOSoul-linux-${{ github.ref_name || github.event.inputs.tag_name }}.tar.gz -C release .

    - name: Package for macOS
      if: matrix.os == 'macos-latest'
      run: |
        mkdir -p release
        cp dist/${{ matrix.binary_name }} release/
        tar -czf JOJOSoul-mac-${{ github.ref_name || github.event.inputs.tag_name }}.tar.gz -C release .

    - name: Upload Release Asset (Linux)
      if: matrix.os == 'ubuntu-latest'
      uses: actions/upload-release-asset@v1
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      with:
        upload_url: ${{ needs.create-release.outputs.upload_url }}
        asset_path: ./JOJOSoul-linux-${{ github.ref_name || github.event.inputs.tag_name }}.tar.gz
        asset_name: JOJOSoul-linux-${{ github.ref_name || github.event.inputs.tag_name }}.tar.gz
        asset_content_type: application/gzip

    - name: Upload Release Asset (Windows)
      if: matrix.os == 'windows-latest'
      uses: actions/upload-release-asset@v1
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      with:
        upload_url: ${{ needs.create-release.outputs.upload_url }}
        asset_path: ./dist/${{ matrix.binary_name }}${{ matrix.binary_extension }}
        asset_name: JOJOSoul-windows-${{ github.ref_name || github.event.inputs.tag_name }}${{ matrix.binary_extension }}
        asset_content_type: application/vnd.microsoft.portable-executable

    - name: Upload Release Asset (macOS)
      if: matrix.os == 'macos-latest'
      uses: actions/upload-release-asset@v1
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      with:
        upload_url: ${{ needs.create-release.outputs.upload_url }}
        asset_path: ./JOJOSoul-mac-${{ github.ref_name || github.event.inputs.tag_name }}.tar.gz
        asset_name: JOJOSoul-mac-${{ github.ref_name || github.event.inputs.tag_name }}.tar.gz
        asset_content_type: application/gzip

  